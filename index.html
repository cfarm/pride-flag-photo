<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.png">
    <title>Celebrate Pride</title>
    <link rel="stylesheet" href="buttons-min.css">
</head>
<style>
.is-center {
    text-align: center;
     margin: auto;
      width: 100%;
}
</style>

<body bgcolor="#F8BBD0">
  <div class="is-center" id="container">
	<canvas id="canvas" style="display:none"></canvas>
  <h1>Celebrate Pride!</h1>
  <input type="file"  id = "upload-input" style="display: none;">
	<button id="upload-btn" style="margin-top:20%;" class="pure-button pure-button-primary">Upload a photo</button>
</div>
</body>
<script src="jquery-1.11.3.min.js"></script>
<script>
  var canvas = $('#canvas');
  var imgurID = window.location.href.split('#')[1];
  if(imgurID != null){
    $("#upload-btn").hide();
    var img = new Image();
    img.setAttribute('crossOrigin', 'anonymous');
    img.onload = imgOnLoad;
    img.src = "http://i.imgur.com/"+imgurID+".png";
  }


$( "#upload-btn" ).on( "click", function() { $("#upload-input").click(); });
$('#upload-input').change(function(e) {
      var file = e.target.files[0],
          imageType = /image.*/;

      if (!file.type.match(imageType))
          return;

      var reader = new FileReader();
      reader.onload = fileOnload;
      reader.readAsDataURL(file);
  });

  function imgOnLoad(){
    $("#upload-btn").hide();
    var res = this.height/this.width;
    var scale = Math.min.apply(Math, [$(window).width(), $(window).height(), this.height, this.width]);
    var width = canvas[0].width =   scale;
    var height = canvas[0].height = scale*res;
    var context = canvas[0].getContext('2d');
    var flag= {
        colors: [
          'rgba(0,0,0,0.75)', // black
          'rgba(113,82,35,0.5)', // brown
          'rgba(255,0,0,0.4)', // red
          'rgba(255,153,0,0.5)', // orange
          'rgba(255,255,0,0.3)', // yellow
          'rgba(0,153,0,0.3)', // green
          'rgba(0,0,255,0.3)', // blue
          'rgba(204,0,153,0.3)' // voilet
        ],
        stripeHeight: 0.125,
        stripes: 8
    }
    context.drawImage(this, 0, 0,width,height);

    for (var i = 0; i < flag.stripes; i++) {
      var stripeStart = 0;
      context.fillStyle = flag.colors[i];
      if (i == 0) {
        stripeStart = 0;
      } else {
        stripeStart = height*flag.stripeHeight* (i-1);
      }
      context.fillRect(0,stripeStart,width,height*flag.stripeHeight*i);
    }
    // context.fillStyle = flag.colors.red;
    // context.fillRect(0,0,width,height*flag.stripeHeight);
    // context.fillStyle = flag.colors.orange;
    // context.fillRect(0,height*flag.stripeHeight,width,height*flag.stripeHeight*2);
    // context.fillStyle = flag.colors.yellow;
    // context.fillRect(0,height*flag.stripeHeight*2,width,height*flag.stripeHeight*3);
    // context.fillStyle = flag.colors.green;
    // context.fillRect(0,height*flag.stripeHeight*3,width,height*flag.stripeHeight*4);
    // context.fillStyle = flag.colors.blue;
    // context.fillRect(0,height*flag.stripeHeight*4,width,height*flag.stripeHeight*5);
    // context.fillStyle = flag.colors.violet;
    // context.fillRect(0,height*flag.stripeHeight*5,width,height*flag.stripeHeight*6);
    var img = new Image();
    img.src = canvas[0].toDataURL();
    $("#container").append(img);
  }
  function fileOnload(e) {
      var img = new Image();
      img.onload = imgOnLoad;
      img.src = e.target.result;
  }
</script>
</html>
